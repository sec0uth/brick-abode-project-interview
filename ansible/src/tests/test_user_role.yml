---

- name: Test user role add user
  hosts: ios
  
  # facts are not used in testing
  gather_facts: false

  pre_tasks:
    - name: Ensure user does not exists yet
      ios_user:
        name: little-cisco
        nopassword: true
        state: absent

  roles:
    # provide testing vars
    - role: user
      vars:
        user:
          name: little-cisco

  post_tasks:
    - name: Ensure user is already created
      ios_user:
        name: little-cisco
        nopassword: true
        state: present
      register: user_state
      failed_when: user_state.changed